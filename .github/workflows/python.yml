name: Multi-arch Python

# Only run on branches (e.g. not tags)
on:
  workflow_dispatch:

jobs:
  install_python:
    strategy:
      matrix:
        include:
          - arch: s390x
            runner: ubuntu-24.04-s390x
          - arch: ppc64le
            runner: ubuntu-24.04-ppc64le
          - arch: amd64
            runner: ubuntu-24.04
    runs-on: ${{ matrix.runner }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Setup Python on ${{ matrix.arch }}
        if: matrix.arch == 'amd64'
        uses: actions/setup-python@v6
        with:
          python-version: 3.11

      - name: Setup Python on ${{ matrix.arch }}
        if: matrix.arch != 'amd64'
        uses: IBM/setup-python-pz@v6.0
        with:
          architecture: ${{ matrix.arch }}
          python-version: 3.11

      - name: Verify Python
        run: | 
          ls -l /opt/hostedtoolcache/Python/3.11.14/ppc64le/lib
          sudo find / -name "libpython3.11.so.1.0"
          python --version
          python -c "import platform; print(platform.machine())"
